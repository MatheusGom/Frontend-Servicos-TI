<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Clientes - TI Solutions</title>
    <link rel="stylesheet" href="../style/style.css">
</head>
<body>
    <div class="container">
        <div class="form-container">
            <img src="https://via.placeholder.com/150" alt="Logo da TI Solutions" class="logo" style="display: block; margin: 0 auto 20px;">
            <h2>Cadastro de Clientes</h2>
            <form id="cadastroForm" onsubmit="return false;">
                <div class="form-group">
                    <label for="email">E-mail (login):</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="senha">Senha:</label>
                    <input type="password" id="senha" required>
                </div>
                <div class="form-group">
                    <label for="confirmaSenha">Confirmação de Senha:</label>
                    <input type="password" id="confirmaSenha" required>
                </div>
                 <div class="password-rules">
                    <strong>Regras para a senha:</strong>
                    <ul>
                        <li>Pelo menos 6 caracteres, uma letra maiúscula, um número e um caractere especial (@#$%&!?/+=.).</li>
                        <li>Não são permitidos: }^;<>.</li>
                    </ul>
                </div>
                <div class="form-group">
                    <label for="nome">Nome Completo:</label>
                    <input type="text" id="nome" required>
                </div>
                <div class="form-group">
                    <label for="cpf">CPF:</label>
                    <input type="text" id="cpf" placeholder="000.000.000-00" required>
                </div>
                <div class="form-group">
                    <label for="nascimento">Data de Nascimento:</label>
                    <input type="date" id="nascimento" required>
                </div>
                <div class="form-group">
                    <label for="celular">Celular/WhatsApp (opcional):</label>
                    <input type="text" id="celular" placeholder="(00) 00000-0000">
                </div>
                <div class="form-group">
                    <label>Estado Civil:</label>
                    <input type="radio" name="estadoCivil" value="solteiro" checked> Solteiro(a)
                    <input type="radio" name="estadoCivil" value="casado"> Casado(a)
                    <input type="radio" name="estadoCivil" value="divorciado"> Divorciado(a)
                    <input type="radio" name="estadoCivil" value="viuvo"> Viúvo(a)
                </div>
                <div class="form-group">
                    <label for="escolaridade">Escolaridade:</label>
                    <select id="escolaridade">
                        <option value="1incompleto">1º grau incompleto</option>
                        <option value="1completo">1º grau completo</option>
                        <option value="2completo" selected>2º grau completo</option>
                        <option value="superior">Nível superior</option>
                        <option value="pos">Pós-graduado</option>
                    </select>
                </div>

                <div class="form-buttons">
                    <button type="button" onclick="realizarInclusao()">Incluir</button>
                    <button type="button" class="secondary" onclick="limparCampos()">Limpar</button>
                    <button type="button" class="secondary" onclick="window.history.back()">Voltar</button>
                </div>
            </form>
        </div>
    </div>
    <script>
    // Adiciona a máscara de CPF
    document.getElementById('cpf').addEventListener('input', function (e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        e.target.value = value;
    });

    // Adiciona a máscara de Celular
    document.getElementById('celular').addEventListener('input', function (e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
        value = value.replace(/(\d)(\d{4})$/, '$1-$2');
        e.target.value = value;
    });

    function validarCPF(cpf) {
        cpf = cpf.replace(/[^\d]+/g,'');	
        if(cpf == '') return false;	
        if (cpf.length != 11 || /^(\d)\1+$/.test(cpf)) return false;	
        let add = 0;	
        for (let i=0; i < 9; i ++) add += parseInt(cpf.charAt(i)) * (10 - i);	
        let rev = 11 - (add % 11);	
        if (rev == 10 || rev == 11) rev = 0;	
        if (rev != parseInt(cpf.charAt(9))) return false;		
        add = 0;	
        for (let i = 0; i < 10; i ++) add += parseInt(cpf.charAt(i)) * (11 - i);	
        rev = 11 - (add % 11);	
        if (rev == 10 || rev == 11) rev = 0;	
        if (rev != parseInt(cpf.charAt(10))) return false;		
        return true;   
    }
    
    function validarCelular(celular) {
        const value = celular.replace(/\D/g, '');
        // Valida o formato (XX) XXXXX-XXXX ou (XX) XXXX-XXXX
        const regex = /^(?:(?:\+|00)?(55)\s?)?(?:\(?([1-9][0-9])\)?\s?)?(?:((?:9\d|[2-9])\d{3})\-?(\d{4}))$/;
        return regex.test(value);
    }

    function realizarInclusao() {
        // Validações de senha (reutilizadas da troca de senha)
        const senha = document.getElementById('senha').value;
        const confirmaSenha = document.getElementById('confirmaSenha').value;
        if (senha !== confirmaSenha) { alert('As senhas não coincidem.'); return; }
        if (senha.length < 6 || !/[A-Z]/.test(senha) || !/\d/.test(senha) || !/[@#$%&!?/+=.]/.test(senha) || /[}\^;<>]/.test(senha)) {
            alert('A senha não atende aos critérios de segurança.');
            return;
        }

        // Validação de nome
        const nome = document.getElementById('nome').value.trim();
        if (!nome) { alert('O nome deve ser preenchido.'); return; }
        const nomePartes = nome.split(' ');
        if (nomePartes.length < 2 || nomePartes[0].length < 2) {
            alert('O nome deve ter pelo menos duas palavras e a primeira deve ter no mínimo 2 caracteres.');
            return;
        }
        // Ajuste na validação de caracteres especiais para o nome 
        if (/[@#$%&!?/+=.}{\^;<>]/.test(nome)) {
             alert('O nome não deve conter caracteres especiais.');
             return;
        }
        
        // Validação de CPF
        const cpf = document.getElementById('cpf').value;
        if (!cpf) { alert('O CPF deve ser preenchido.'); return; }
        if (!validarCPF(cpf)) { alert('O CPF informado é inválido.'); return; }

        // Validação de data de nascimento (maior de 18 anos)
        const dataNascimento = new Date(document.getElementById('nascimento').value);
        if (isNaN(dataNascimento.getTime())) { alert('A data de nascimento deve ser preenchida.'); return; }
        const hoje = new Date();
        let idade = hoje.getFullYear() - dataNascimento.getFullYear();
        const m = hoje.getMonth() - dataNascimento.getMonth();
        if (m < 0 || (m === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }
        if (idade < 18) {
            alert('O cliente deve ser maior de 18 anos.');
            return;
        }

        // Validação do celular (se preenchido) 
        const celular = document.getElementById('celular').value;
        if (celular && !validarCelular(celular)) {
            alert('O formato do celular é inválido. Use (XX) XXXXX-XXXX.');
            return;
        }
        
        alert('Validação realizada com sucesso!');
    }
    
    function limparCampos() {
        document.getElementById('cadastroForm').reset();
        // Reseta os valores default manualmente
        document.querySelector('input[name="estadoCivil"][value="solteiro"]').checked = true;
        document.getElementById('escolaridade').value = '2completo';
        document.getElementById('email').focus();
    }
</script>
</body>
</html>